<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Project - Sign Up</title>
    <link rel="stylesheet" href="../css/sign-up-page-style.css">
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo">
            <img src="https://upload.wikimedia.org/wikipedia/en/3/30/Java_programming_language_logo.svg" alt="Java Logo" width="48" height="48">
            <span>Mini Project</span>
        </div>
        <div class="header-right">
            <span>Already have an account?</span>
            <button class="login-btn">Login</button>
        </div>
    </div>

    <!-- Conteneur principal -->
    <div class="container">
        <div class="form-card">
            <h2>Seconds to sign up!</h2>
            
            <form>
                <div class="form-group">
                    <label for="firstname">Full Name</label>
                    <div class="input-wrapper">
                        
                        <input type="text" id="firstname" placeholder="First Name" class="input-with-icon">
                    </div>
                </div>
                 <div class="form-group">
                    <label for="lastname">Last Name</label>
                    <div class="input-wrapper">
                        
                        <input type="text" id="lastname" placeholder="Last Name" class="input-with-icon">
                    </div>
                </div>

                <div class="form-group">
                    <label for="email">Work Email</label>
                    <div class="input-wrapper">
                        
                        <input type="email" id="email" placeholder="example@site.com" class="input-with-icon">
                    </div>
                </div>

                <div class="form-group">
                    <label for="role">Select your role</label>
                    <div class="input-wrapper">
                        <select id="role" class="select-dropdown">
                            <option value="Member" selected>Member (default)</option>
                            <option value="Developer">Developer</option>
                            <option value="Designer">Designer</option>
                            <option value="Tester">Tester</option>
                            <option value="QA Engineer">QA Engineer</option>
                            <option value="DevOps">DevOps</option>
                            <option value="Manager">Manager</option>
                            <option value="Project Manager">Project Manager</option>
                            <option value="Product Manager">Product Manager</option>
                            <option value="Scrum Master">Scrum Master</option>
                            <option value="Tech Lead">Tech Lead</option>
                            <option value="Architect">Architect</option>
                            <option value="Data Scientist">Data Scientist</option>
                            <option value="Data Engineer">Data Engineer</option>
                            <option value="Security Engineer">Security Engineer</option>
                            <option value="Business Analyst">Business Analyst</option>
                            <option value="Support Engineer">Support Engineer</option>
                            <option value="UX/UI Designer">UX/UI Designer</option>
                            <option value="Intern">Intern</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="password">Choose Password</label>
                    <div class="input-wrapper">
                        
                        <input type="password" id="password" placeholder="Minimum 8 characters" class="input-with-icon-btn">
                        <button type="button" class="show-hide" onclick="togglePassword('password')">Show</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="confirm-password">Confirm Password</label>
                    <div class="input-wrapper">
                        
                        <input type="password" id="confirm-password" placeholder="Minimum 8 characters" class="input-with-icon-btn">
                        <button type="button" class="show-hide" onclick="togglePassword('confirm-password')">Show</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="skills">Select your skills</label>
                    <div class="input-wrapper">
                        <button type="button" class="skills-btn" onclick="openSkillsModal()">Choose your skills...</button>
                    </div>
                </div>

                <button type="submit" class="signup-btn">Sign Up</button>

                <div class="divider">
                    <span>OR</span>
                </div>

                <button type="button" class="google-btn">
                    <svg width="20" height="20" viewBox="0 0 20 20">
                        <path d="M19.6 10.23c0-.82-.1-1.42-.25-2.05H10v3.72h5.5c-.15.96-.74 2.31-2.04 3.22v2.45h3.16c1.89-1.73 2.98-4.3 2.98-7.34z" fill="#4285F4"/>
                        <path d="M13.46 15.13c-.83.59-1.96 1-3.46 1-2.64 0-4.88-1.74-5.68-4.15H1.07v2.52C2.72 17.75 6.09 20 10 20c2.7 0 4.96-.89 6.62-2.42l-3.16-2.45z" fill="#34A853"/>
                        <path d="M3.99 10c0-.69.12-1.35.32-1.97V5.51H1.07A9.973 9.973 0 000 10c0 1.61.39 3.14 1.07 4.49l3.24-2.52c-.2-.62-.32-1.28-.32-1.97z" fill="#FBBC05"/>
                        <path d="M10 3.88c1.88 0 3.13.81 3.85 1.48l2.84-2.76C14.96.99 12.7 0 10 0 6.09 0 2.72 2.25 1.07 5.51l3.24 2.52C5.12 5.62 7.36 3.88 10 3.88z" fill="#EA4335"/>
                    </svg>
                    Continue with Google
                </button>

                <div class="form-footer">
                    By continuing, you agree to our <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Icône d'aide -->
    <div class="help-icon">
        <span class="help-text">?</span>
        <span class="help-label">Help</span>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>Copyright © 2025 Enetcom®. All rights reserved</p>
        <p>Join our community and be productive!</p>
    </div>

    <!-- Skills Modal -->
    <div id="skillsModal" class="modal">
        <div class="modal-content" style="max-height: 80vh; overflow-y: auto;">
            <div style="padding: 0 20px 20px;">
                <h2>Select Your Skills</h2>
                <p style="color: #6b7280; font-size: 14px; margin-bottom: 20px;">Skills are loaded from the database. Pick the ones that match you.</p>

                <div id="skills-error" style="display: none; color: #dc2626; margin-bottom: 12px; font-weight: 600;">Unable to load skills. Please try again.</div>
                <div class="skills-category" id="skills-dynamic-section">
                    <h3 style="color: #1f2937; font-size: 16px; font-weight: 600; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #e5e7eb;">Available Skills</h3>
                    <div class="skills-grid" id="skills-grid-dynamic">
                        <span id="skills-loading" style="color: #6b7280;">Loading skills...</span>
                    </div>
                </div>

                <div class="modal-footer" style="margin-top: 24px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                    <button class="back-btn" onclick="closeSkillsModal()"><span>‹</span> Back</button>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span id="selected-count" style="color: #6b7280; font-size: 13px;">0 selected</span>
                        <button class="next-btn" onclick="saveSkills()" id="save-skills-btn" disabled>Next <span>›</span></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SIGNUP_API_BASE_URL = typeof API_BASE_URL !== 'undefined' ? API_BASE_URL : 'http://localhost:8080/mini_projet/api';
        let selectedSkills = [];
        let availableSkills = [];

        function openSkillsModal() {
            document.getElementById('skillsModal').style.display = 'flex';
        }

        function closeSkillsModal() {
            document.getElementById('skillsModal').style.display = 'none';
        }

        async function loadSkillsFromDatabase() {
            const grid = document.getElementById('skills-grid-dynamic');
            const errorEl = document.getElementById('skills-error');
            if (!grid) return;
            grid.innerHTML = '<span id="skills-loading" style="color: #6b7280;">Loading skills...</span>';
            errorEl.style.display = 'none';
            try {
                const response = await fetch(`${SIGNUP_API_BASE_URL}/skills`);
                if (!response.ok) {
                    throw new Error('Failed to load skills');
                }
                availableSkills = await response.json();
                renderSkills(availableSkills);
            } catch (err) {
                console.error('Error loading skills:', err);
                grid.innerHTML = '';
                errorEl.style.display = 'block';
            }
        }

        function renderSkills(skills) {
            const grid = document.getElementById('skills-grid-dynamic');
            if (!grid) return;
            if (!skills || skills.length === 0) {
                grid.innerHTML = '<span style="color: #6b7280;">No skills available</span>';
                return;
            }
            grid.innerHTML = '';
            skills.forEach(skill => {
                const button = document.createElement('button');
                button.className = 'skill-item';
                button.dataset.skillId = skill.id;
                button.dataset.skillName = skill.name;
                button.innerHTML = `<span class="skill-badge">${skill.name}</span>`;
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    toggleSkillSelection(this, skill);
                });
                grid.appendChild(button);
            });
            restoreSelectionState();
        }

        function toggleSkillSelection(button, skill) {
            const isSelected = button.classList.toggle('selected');
            const alreadySelected = selectedSkills.find(s => s.id === skill.id);
            if (isSelected) {
                if (!alreadySelected) {
                    selectedSkills.push({ id: skill.id, name: skill.name });
                }
            } else {
                selectedSkills = selectedSkills.filter(s => s.id !== skill.id);
            }
            updateSelectedCount();
        }

        function restoreSelectionState() {
            const grid = document.getElementById('skills-grid-dynamic');
            if (!grid) return;
            selectedSkills.forEach(sel => {
                const btn = grid.querySelector(`button[data-skill-id="${sel.id}"]`);
                if (btn) {
                    btn.classList.add('selected');
                }
            });
            updateSelectedCount();
        }

        function saveSkills() {
            const skillsBtn = document.querySelector('.skills-btn');
            if (selectedSkills.length > 0) {
                skillsBtn.textContent = `${selectedSkills.length} skill${selectedSkills.length !== 1 ? 's' : ''} selected`;
                skillsBtn.style.color = '#00a6c0';
            }
            closeSkillsModal();
        }

        function updateSelectedCount() {
            const countEl = document.getElementById('selected-count');
            const btnEl = document.getElementById('save-skills-btn');
            if (countEl) {
                countEl.textContent = `${selectedSkills.length} selected`;
            }
            if (btnEl) {
                btnEl.disabled = selectedSkills.length === 0;
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadSkillsFromDatabase();
            updateSelectedCount();
        });

        function togglePassword(id) {
            const input = document.getElementById(id);
            const button = input.nextElementSibling;
            
            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = 'Hide';
            } else {
                input.type = 'password';
                button.textContent = 'Show';
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('skillsModal');
            if (event.target === modal) {
                closeSkillsModal();
            }
        }
    </script>
    <script src="../js/auth.js"></script>
</body>
</html>